<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="en,zh-Hans,fr-FR,default">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32world.png?v=5.1.4">



  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="pentest," />










<meta name="description" content="文件上传漏洞文件上传攻击是指攻击者利用 web 应用对上传文件过滤不严的漏洞，将应用程序定义类型范围之外的文件上传到web 服务器。此类文件通常为木马，上传成功后攻击者即可获得当前的 webshell Webshell: 非法用户利用上传的恶意脚本文件控制整个网站，甚至控制服务器，这个恶意脚本文件，又被称为 webshell 漏洞存在前提:  存在上传点 上传文件可被顺利解析  漏洞利用成功的关键">
<meta name="keywords" content="pentest">
<meta property="og:type" content="article">
<meta property="og:title" content="DVWA 文件上传漏洞测试过程">
<meta property="og:url" content="http://yoursite.com/2019/12/24/practice-pentest-dvwa-fileupload/index.html">
<meta property="og:site_name" content="Ninon&#39;s">
<meta property="og:description" content="文件上传漏洞文件上传攻击是指攻击者利用 web 应用对上传文件过滤不严的漏洞，将应用程序定义类型范围之外的文件上传到web 服务器。此类文件通常为木马，上传成功后攻击者即可获得当前的 webshell Webshell: 非法用户利用上传的恶意脚本文件控制整个网站，甚至控制服务器，这个恶意脚本文件，又被称为 webshell 漏洞存在前提:  存在上传点 上传文件可被顺利解析  漏洞利用成功的关键">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://yoursite.com/2019/12/24/practice-pentest-dvwa-fileupload/fu-low-form.png">
<meta property="og:image" content="http://yoursite.com/2019/12/24/practice-pentest-dvwa-fileupload/fu-low-upload.png">
<meta property="og:image" content="http://yoursite.com/2019/12/24/practice-pentest-dvwa-fileupload/fu-low-phpinfo.png">
<meta property="og:image" content="http://yoursite.com/2019/12/24/practice-pentest-dvwa-fileupload/fu-medium-upload.png">
<meta property="og:image" content="http://yoursite.com/2019/12/24/practice-pentest-dvwa-fileupload/fu-medium-typechange.png">
<meta property="og:updated_time" content="2019-12-24T01:40:00.771Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="DVWA 文件上传漏洞测试过程">
<meta name="twitter:description" content="文件上传漏洞文件上传攻击是指攻击者利用 web 应用对上传文件过滤不严的漏洞，将应用程序定义类型范围之外的文件上传到web 服务器。此类文件通常为木马，上传成功后攻击者即可获得当前的 webshell Webshell: 非法用户利用上传的恶意脚本文件控制整个网站，甚至控制服务器，这个恶意脚本文件，又被称为 webshell 漏洞存在前提:  存在上传点 上传文件可被顺利解析  漏洞利用成功的关键">
<meta name="twitter:image" content="http://yoursite.com/2019/12/24/practice-pentest-dvwa-fileupload/fu-low-form.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/12/24/practice-pentest-dvwa-fileupload/"/>





  <title>DVWA 文件上传漏洞测试过程 | Ninon's</title>
  








</head>


<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Ninon's</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">to be continued</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/24/practice-pentest-dvwa-fileupload/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yanyan NIE">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ninon's">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">DVWA 文件上传漏洞测试过程</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted</span>
              
              <time title="Created" itemprop="dateCreated datePublished" datetime="2019-12-24T09:32:15+08:00">
                2019-12-24
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Modified&#58;</span>
              
              <time title="Modified" itemprop="dateModified" datetime="2019-12-24T09:40:00+08:00">
                2019-12-24
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/practice/" itemprop="url" rel="index">
                    <span itemprop="name">practice</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/12/24/practice-pentest-dvwa-fileupload/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/12/24/practice-pentest-dvwa-fileupload/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i> views
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text"> &#58;</span>
                
                <span title=" ">
                  3.2k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">  &asymp;</span>
                
                <span title=" ">
                  13
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="文件上传漏洞"><a href="#文件上传漏洞" class="headerlink" title="文件上传漏洞"></a>文件上传漏洞</h1><p>文件上传攻击是指攻击者利用 web 应用对上传文件过滤不严的漏洞，将应用程序定义类型范围之外的文件上传到web 服务器。此类文件通常为木马，上传成功后攻击者即可获得当前的 webshell</p>
<p>Webshell: 非法用户利用上传的恶意脚本文件控制整个网站，甚至控制服务器，这个恶意脚本文件，又被称为 webshell</p>
<p>漏洞存在前提:</p>
<ul>
<li>存在上传点</li>
<li>上传文件可被顺利解析</li>
</ul>
<p>漏洞利用成功的关键：</p>
<ul>
<li>目标网站具有上传功能 ：</li>
<li>上传目标能被 web 服务器解析执行</li>
<li>知道文件上传到服务器后的存放路径和文件名称</li>
<li>目标文件可被用户访问</li>
</ul>
<h2 id="上传检测绕过技术"><a href="#上传检测绕过技术" class="headerlink" title="上传检测绕过技术"></a>上传检测绕过技术</h2><h3 id="客户端-JS-检测及绕过"><a href="#客户端-JS-检测及绕过" class="headerlink" title="客户端 JS 检测及绕过"></a>客户端 JS 检测及绕过</h3><p>客户端部署 JS 脚本，对用户表单提交的数据进行检查，终止非法后缀文件的上传</p>
<ul>
<li>绕过方式<ul>
<li>直接删除代码中 onsubmit 事件</li>
<li>直接更改 JS 脚本，加入预期的扩展名</li>
<li>浏览器禁用 JS 方式，禁止防护脚本执行</li>
<li>如果这种手段在发出 HTTP 包之前执行完毕，攻击者可利用 web 代理（burpsuite/finddler）抓取含有上传表单的 HTTP 数据包，并在包中修改为非法后缀（.php 等）</li>
</ul>
</li>
</ul>
<h3 id="服务器端-MIME-检测及绕过"><a href="#服务器端-MIME-检测及绕过" class="headerlink" title="服务器端 MIME 检测及绕过"></a>服务器端 MIME 检测及绕过</h3><p>HTTP 中的 Content-type（MIME 信息） 标识本次上传的内容类型，MIME 由客户端浏览器自动生成。例如，允许上传的文件 Content-type 值为 image/jpg, image/gif, image/png，如果攻击者上传的文件为 “mama.php”，则对应类型为 text/html</p>
<ul>
<li>绕过方式<ul>
<li>HTTP 抓包修改 Content-type 类型：将“.php”对应的 MIME修改为合法 MIME 类型绕过检测</li>
</ul>
</li>
</ul>
<h3 id="服务器端文件扩展名检测及绕过"><a href="#服务器端文件扩展名检测及绕过" class="headerlink" title="服务器端文件扩展名检测及绕过"></a>服务器端文件扩展名检测及绕过</h3><p>服务器端检测上传文件的扩展名，主要通过文件后缀黑白名单过滤；完全不信任用户上传文件的后缀名，重新添加后缀（只能指定一种后缀名，适用场景单一）</p>
<ul>
<li><p>防护方式：</p>
<ul>
<li><code>文件后缀重命名</code>：只允许单一文件上传，例如针对头像，只允许上传 JPG 格式。配合对文件名的随机数文件名生成方法</li>
<li><code>白名单过滤</code>：只允许一种类型的文件上传，如图片</li>
<li><code>黑名单过滤</code>：允许多种类型文件上传</li>
</ul>
</li>
<li><p>绕过方式：构造非限制条件、截断漏洞</p>
<ul>
<li>黑名单绕过<ul>
<li><code>多重测试过滤文件名</code></li>
<li><code>判断是否存在大小写绕过</code>：<strong>中间件区分文件名大小写，操作系统不区分文件后缀名的大小写</strong></li>
<li><code>特殊文件名构造</code><strong>（windows 下）</strong>：burpsuite劫持HTTP 包，修改后缀类似于：”.php.”或”.php_”，windows下不识别这种后缀机制，会自动去掉<code>“.”、“_”</code>等特殊符号</li>
<li><code>%00截断</code>：<strong>C 语言的终止符特性</strong>（%00会被当成终止符，程序自动阶段后续信息，仅保留之前的内容）；此漏洞仅存在于 <code>PHP 5.3.7</code> 之前的版本，如“shell.php .jpg”(.jpg前有一空格)</li>
</ul>
</li>
<li>白名单绕过<ul>
<li>特殊文件名构造</li>
<li>0x00 截断</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="服务器端文件内容检测及绕过"><a href="#服务器端文件内容检测及绕过" class="headerlink" title="服务器端文件内容检测及绕过"></a>服务器端文件内容检测及绕过</h3><ul>
<li><p>防护方式</p>
<ul>
<li>通过检测上传文件的文件头来判断当前文件格式：通常前 10 个字节基本上就能判断出一个文件的真实类型</li>
<li>通过调用 API 或函数对文件进行加载测试，常见的是图像二次渲染：关键函数 <code>imagecreatefromjpeg/imagecreatefromgif/imagecreatefrompng 等从 jpeg/gif/png</code> 生成新图片，而插入的木马无法渲染成像素，因此在渲染过程中被丢弃</li>
<li>检测上传文件是否为图像文件内容：<code>getimagesize()</code>函数可获取图片的高度和宽度的像素值，再与获取到的图片信息进行比对，如果相同则进行保存，不同则放弃代码执行</li>
</ul>
</li>
<li><p>绕过方式</p>
<ul>
<li>针对文件头检测：修改文件头，对前 20 字节进行替换；在文件内容前添加 GIF89a，web 系统可判断当前文件类型为 GIF 类型</li>
<li>针对二次渲染（超难！）：基于数据二义性，让数据既是图像也包含一句话木马；对文件加载器进行溢出攻击</li>
</ul>
</li>
</ul>
<h2 id="文件解析攻击"><a href="#文件解析攻击" class="headerlink" title="文件解析攻击"></a>文件解析攻击</h2><h3 id="htaccess-攻击"><a href="#htaccess-攻击" class="headerlink" title=".htaccess 攻击"></a>.htaccess 攻击</h3><p>.htaccess 可配置解析目标，例如允许字符“XXE”的文件以 PHP 方式执行。所以虽然用户端做了大量的防护功能，但是可利用虚拟目录功能实现中间件层的解析欺骗，导致木马可以非正常后缀名进行执行。</p>
<h3 id="web-服务器解析漏洞攻击"><a href="#web-服务器解析漏洞攻击" class="headerlink" title="web 服务器解析漏洞攻击"></a>web 服务器解析漏洞攻击</h3><ul>
<li><p>Apache 解析漏洞攻击</p>
<p>  apache早期版本从右至左判断后缀，直到找到可识别后缀；需要注意集成环境软件版本并不是中间件版本，须严格检查集成环境中的 Apache 和 PHP 版本</p>
</li>
<li><p>IIS 解析漏洞攻击</p>
<ul>
<li><p>6.0 环境</p>
<ul>
<li>若目录名包含“.asp”字符串，那么这个目录下所有的文件都会按照 asp 格式解析</li>
<li>只要文件名含有“.asp”，就会优先按 asp来解析</li>
<li>默认的可执行文件还包含：/xxx.asa、/xxx.cer、/xxx.cdx</li>
</ul>
</li>
<li><p>7.0/7.5</p>
<ul>
<li>主要是对 php 解析时存在类似于 Nginx 的解析漏洞，并且处于 Fast-CGI 开启状态</li>
<li>只要在任意文件名的 URL 后追加字符串<strong>“/任意文件名.php”</strong>，那么当前文件就会按照 php 的方式解析；此环境下的解析漏洞是由于 php-cgi 本身的问题导致，与 IIS 自身并没有直接关系</li>
</ul>
</li>
</ul>
</li>
<li><p>Nginx解析漏洞攻击    </p>
<ul>
<li>出自 php-cgi 的漏洞<strong>“/任意文件名.php”</strong>解析攻击</li>
<li>对低版本 Nginx ，在任意文件后面添加%00.php 进行解析攻击</li>
</ul>
</li>
</ul>
<h2 id="竞争条件攻击"><a href="#竞争条件攻击" class="headerlink" title="竞争条件攻击"></a>竞争条件攻击</h2><p>利用文件上传成功后和服务器删除文件之间存在的时间差（因为要执行检查文件和删除文件的操作），攻击者完成竞争条件的上传漏洞攻击</p>
<h1 id="DVWA-测试过程"><a href="#DVWA-测试过程" class="headerlink" title="DVWA 测试过程"></a>DVWA 测试过程</h1><p>测试目标：</p>
<p>Execute any PHP function of your choosing on the target system (such as <code>phpinfo()</code>    or <code>system()</code>) thanks to this file upload vulnerability.</p>
<h2 id="PHP-FILES-数组"><a href="#PHP-FILES-数组" class="headerlink" title="PHP $_FILES 数组"></a>PHP <code>$_FILES</code> 数组</h2><p>当客户端提交后，我们获得了一个$_FILES 数组, $_FILES数组内容如下:</p>
<ul>
<li><p><code>$\_FILES[&#39;myFile&#39;][&#39;name&#39;]</code> 客户端文件的原名称。</p>
</li>
<li><p><code>$\_FILES[&#39;myFile&#39;][&#39;type&#39;]</code> 文件的 MIME 类型，需要浏览器提供该信息的支持，例如”image/gif”。</p>
</li>
<li><p><code>$\_FILES[&#39;myFile&#39;][&#39;size&#39;]</code> 已上传文件的大小，单位为字节。</p>
</li>
<li><p><code>$\_FILES[&#39;myFile&#39;][&#39;tmp_name&#39;]</code> 文件被上传后在服务端储存的临时文件名，一般是系统默认。可以在 <strong>php.ini</strong> 的 <strong>upload_tmp_dir</strong> 指定，但 用 putenv() 函数设置是不起作用的。</p>
</li>
<li><p><code>$\_FILES[&#39;myFile&#39;][&#39;error&#39;]</code> 和该文件上传相关的错误代码。[‘error’] 是在 PHP 4.2.0 版本中增加的。</p>
<ul>
<li><p><code>UPLOAD_ERR_OK</code></p>
<p>  <strong>值：0</strong>; 没有错误发生，文件上传成功。</p>
</li>
<li><p><code>UPLOAD_ERR_INI_SIZE</code></p>
<p>  <strong>值：1</strong>; 上传的文件超过了 php.ini 中 upload_max_filesize 选项限制的值。</p>
</li>
<li><p><code>UPLOAD_ERR_FORM_SIZE</code></p>
<p>  <strong>值：2</strong>; 上传文件的大小超过了 HTML 表单中 MAX_FILE_SIZE 选项指定的值。</p>
</li>
<li><p><code>UPLOAD_ERR_PARTIAL</code></p>
<p>  <strong>值：3</strong>; 文件只有部分被上传。</p>
</li>
<li><p><code>UPLOAD_ERR_NO_FILE</code></p>
<p>  <strong>值：4;</strong> 没有文件被上传。</p>
<p>  <strong>值：5</strong>; 上传文件大小为0. </p>
</li>
</ul>
</li>
</ul>
<p>文件被上传结束后，默认地被存储在了<strong>临时目录</strong>中，这时您必须将它从临时目录中删除或移动到其它地方，<strong>如果没有，则会被删除。</strong>也就是不管是否上传成功，脚本执行完后临时目录里的文件肯定会被删除。所以<strong>在删除之前要将它复制到其它位置</strong>，此时，才算完成了上传文件过程。 </p>
<h2 id="Level-Low"><a href="#Level-Low" class="headerlink" title="Level Low"></a>Level Low</h2><p><img src="/2019/12/24/practice-pentest-dvwa-fileupload/fu-low-form.png" alt=""></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_POST[ <span class="string">'Upload'</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Where are we going to be writing to?</span></span><br><span class="line">    $target_path  = DVWA_WEB_PAGE_TO_ROOT . <span class="string">"hackable/uploads/"</span>;</span><br><span class="line">    $target_path .= basename( $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'name'</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Can we move the file to the upload folder?</span></span><br><span class="line">    <span class="keyword">if</span>( !move_uploaded_file( $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'tmp_name'</span> ], $target_path ) ) &#123;</span><br><span class="line">        <span class="comment">// No</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Yes!</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;&#123;$target_path&#125; succesfully uploaded!&lt;/pre&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>basename(path,suffix)</code> 函数返回路径中的文件名部分</p>
<ul>
<li>path     必需。规定要检查的路径。</li>
<li>suffix     可选。规定文件扩展名。如果文件有 suffix，则不会输出这个扩展名。</li>
</ul>
<p><code>move_uploaded_file(file,newloc)</code> 函数将上传的文件移动到新位置。若成功，则返回 true，否则返回 false。</p>
<ul>
<li>file     必需。规定要移动的文件。</li>
<li>newloc 必需。规定文件的新位置。</li>
</ul>
<p>low 级别可直接上传 PHP 文件进行攻击</p>
<p><img src="/2019/12/24/practice-pentest-dvwa-fileupload/fu-low-upload.png" alt=""><br><img src="/2019/12/24/practice-pentest-dvwa-fileupload/fu-low-phpinfo.png" alt=""></p>
<h2 id="Level-Medium"><a href="#Level-Medium" class="headerlink" title="Level Medium"></a>Level Medium</h2><p><img src="/2019/12/24/practice-pentest-dvwa-fileupload/fu-medium-upload.png" alt=""></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_POST[ <span class="string">'Upload'</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Where are we going to be writing to?</span></span><br><span class="line">    $target_path  = DVWA_WEB_PAGE_TO_ROOT . <span class="string">"hackable/uploads/"</span>;</span><br><span class="line">    $target_path .= basename( $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'name'</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// File information</span></span><br><span class="line">    $uploaded_name = $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'name'</span> ];</span><br><span class="line">    $uploaded_type = $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'type'</span> ];</span><br><span class="line">    $uploaded_size = $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'size'</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Is it an image?</span></span><br><span class="line">    <span class="keyword">if</span>( ( $uploaded_type == <span class="string">"image/jpeg"</span> || $uploaded_type == <span class="string">"image/png"</span> ) &amp;&amp;</span><br><span class="line">        ( $uploaded_size &lt; <span class="number">100000</span> ) ) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Can we move the file to the upload folder?</span></span><br><span class="line">        <span class="keyword">if</span>( !move_uploaded_file( $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'tmp_name'</span> ], $target_path ) ) &#123;</span><br><span class="line">            <span class="comment">// No</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Yes!</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;&#123;$target_path&#125; succesfully uploaded!&lt;/pre&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Invalid file</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>medium 级别使用白名单机制对接收文件的类型进行了限制（<code>image/jpeg</code> 和<code>image/png</code>），通过 burp 拦截请求，在 content-type 可看到上传的文件类型是<code>text/php</code>。因此正常情况下无法通过后端的类型检测。</p>
<p>但是通过更改请求包中的<code>content-type</code>为上述可接受的两种文件类型，就可以绕过文件类型限制。如图所示，修改后的请求可以将 php 文件成功上传</p>
<p><img src="/2019/12/24/practice-pentest-dvwa-fileupload/fu-medium-typechange.png" alt=""></p>
<h2 id="Level-High"><a href="#Level-High" class="headerlink" title="Level High"></a>Level High</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_POST[ <span class="string">'Upload'</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Where are we going to be writing to?</span></span><br><span class="line">    $target_path  = DVWA_WEB_PAGE_TO_ROOT . <span class="string">"hackable/uploads/"</span>;</span><br><span class="line">    $target_path .= basename( $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'name'</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// File information</span></span><br><span class="line">    $uploaded_name = $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'name'</span> ];</span><br><span class="line">    $uploaded_ext  = substr( $uploaded_name, strrpos( $uploaded_name, <span class="string">'.'</span> ) + <span class="number">1</span>);</span><br><span class="line">    $uploaded_size = $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'size'</span> ];</span><br><span class="line">    $uploaded_tmp  = $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'tmp_name'</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Is it an image?</span></span><br><span class="line">    <span class="keyword">if</span>( ( strtolower( $uploaded_ext ) == <span class="string">"jpg"</span> || strtolower( $uploaded_ext ) == <span class="string">"jpeg"</span> || strtolower( $uploaded_ext ) == <span class="string">"png"</span> ) &amp;&amp;</span><br><span class="line">        ( $uploaded_size &lt; <span class="number">100000</span> ) &amp;&amp;</span><br><span class="line">        getimagesize( $uploaded_tmp ) ) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Can we move the file to the upload folder?</span></span><br><span class="line">        <span class="keyword">if</span>( !move_uploaded_file( $uploaded_tmp, $target_path ) ) &#123;</span><br><span class="line">            <span class="comment">// No</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Yes!</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;&#123;$target_path&#125; succesfully uploaded!&lt;/pre&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Invalid file</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>strrpos(string,find,start)</code> 函数查找字符串在另一字符串中最后一次出现的位置。</p>
<ul>
<li>string     必需。规定被搜索的字符串。</li>
<li>find     必需。规定要查找的字符。</li>
<li>start     可选。规定在何处开始搜索。</li>
</ul>
<p><code>getimagesize()</code> 函数用于获取图像大小及相关信息，成功返回一个数组，失败则返回 FALSE 并产生一条 E_WARNING 级的错误信息。</p>
<p>high 级别中从文件名中截取文件后缀，以此来判断文件类型。并限制文件大小和 getimagesize 函数来检查图片大小。</p>
<p>可通过将一句话木马文件（php）与图片文件进行合并形成新文件将PHP 文件隐藏起来。MacOS下可通过 <code>cat</code> 命令来实现，windows 下可通过 <code>copy</code> 命令来实现。然后上传新文件，实现后端的白名单绕过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat fu.png fu.php &gt; fu_hide.png</span><br><span class="line"></span><br><span class="line"><span class="comment"># fu.php 常见一句话木马</span></span><br><span class="line"><span class="meta">&lt;?php</span> phpinfo(); <span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>($_GET[<span class="string">"cmd"</span>]); <span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> sehll_exec($_GET[<span class="string">'cmd'</span>]); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>上传成功后，需要考虑将上传的 <code>fu_hide.png</code> 文件进行 php 解析执行，获取 webshell。如果没有方法成功以 PHP 方式解析该文件，那么此次的文件上传虽然绕过了后端的白名单限制，仍然没有达到最终获取 webshell 的目的。若网站存在其他漏洞，如文件包含等，可考虑通过其他漏洞来实现文件的执行。</p>
<p>TODO 本次测试中，由于dvwa 安装的 php版本比较高（php7.0.30），所以暂时没有找到合适的方法将包含 PHP 代码的 png 文件进行 php 解析执行。</p>
<h2 id="Level-Impossible"><a href="#Level-Impossible" class="headerlink" title="Level Impossible"></a>Level Impossible</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_POST[ <span class="string">'Upload'</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( $_REQUEST[ <span class="string">'user_token'</span> ], $_SESSION[ <span class="string">'session_token'</span> ], <span class="string">'index.php'</span> );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// File information</span></span><br><span class="line">    $uploaded_name = $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'name'</span> ];</span><br><span class="line">    $uploaded_ext  = substr( $uploaded_name, strrpos( $uploaded_name, <span class="string">'.'</span> ) + <span class="number">1</span>);</span><br><span class="line">    $uploaded_size = $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'size'</span> ];</span><br><span class="line">    $uploaded_type = $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'type'</span> ];</span><br><span class="line">    $uploaded_tmp  = $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'tmp_name'</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Where are we going to be writing to?</span></span><br><span class="line">    $target_path   = DVWA_WEB_PAGE_TO_ROOT . <span class="string">'hackable/uploads/'</span>;</span><br><span class="line">    <span class="comment">//$target_file   = basename( $uploaded_name, '.' . $uploaded_ext ) . '-';</span></span><br><span class="line">    $target_file   =  md5( uniqid() . $uploaded_name ) . <span class="string">'.'</span> . $uploaded_ext;</span><br><span class="line">    $temp_file     = ( ( ini_get( <span class="string">'upload_tmp_dir'</span> ) == <span class="string">''</span> ) ? ( sys_get_temp_dir() ) : ( ini_get( <span class="string">'upload_tmp_dir'</span> ) ) );</span><br><span class="line">    $temp_file    .= DIRECTORY_SEPARATOR . md5( uniqid() . $uploaded_name ) . <span class="string">'.'</span> . $uploaded_ext;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Is it an image?</span></span><br><span class="line">    <span class="keyword">if</span>( ( strtolower( $uploaded_ext ) == <span class="string">'jpg'</span> || strtolower( $uploaded_ext ) == <span class="string">'jpeg'</span> || strtolower( $uploaded_ext ) == <span class="string">'png'</span> ) &amp;&amp;</span><br><span class="line">        ( $uploaded_size &lt; <span class="number">100000</span> ) &amp;&amp;</span><br><span class="line">        ( $uploaded_type == <span class="string">'image/jpeg'</span> || $uploaded_type == <span class="string">'image/png'</span> ) &amp;&amp;</span><br><span class="line">        getimagesize( $uploaded_tmp ) ) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Strip any metadata, by re-encoding image (Note, using php-Imagick is recommended over php-GD)</span></span><br><span class="line">        <span class="keyword">if</span>( $uploaded_type == <span class="string">'image/jpeg'</span> ) &#123;</span><br><span class="line">            $img = imagecreatefromjpeg( $uploaded_tmp );</span><br><span class="line">            imagejpeg( $img, $temp_file, <span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            $img = imagecreatefrompng( $uploaded_tmp );</span><br><span class="line">            imagepng( $img, $temp_file, <span class="number">9</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        imagedestroy( $img );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Can we move the file to the web root from the temp folder?</span></span><br><span class="line">        <span class="keyword">if</span>( rename( $temp_file, ( getcwd() . DIRECTORY_SEPARATOR . $target_path . $target_file ) ) ) &#123;</span><br><span class="line">            <span class="comment">// Yes!</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;&lt;a href='$&#123;target_path&#125;$&#123;target_file&#125;'&gt;$&#123;target_file&#125;&lt;/a&gt; succesfully uploaded!&lt;/pre&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// No</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;'</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Delete any temp files</span></span><br><span class="line">        <span class="keyword">if</span>( file_exists( $temp_file ) )</span><br><span class="line">            unlink( $temp_file );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Invalid file</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>
    
    
    

    <div>
     
       <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------E N D-------------</div>
    
</div>
      
    </div>

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/pentest/" rel="tag"> <i class="fa fa-tag"></i> pentest</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/12/23/installation-docker-dvwa/" rel="next" title="MacOS 下 Docker 安装 DVWA 环境过程">
                <i class="fa fa-chevron-left"></i> MacOS 下 Docker 安装 DVWA 环境过程
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/12/24/case-linuxcmd-grep/" rel="prev" title="Linux grep 总结">
                Linux grep 总结 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="Yanyan NIE" />
            
              <p class="site-author-name" itemprop="name">Yanyan NIE</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">27</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/YanyanNIE" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://instagram.com/yanyan_nie" target="_blank" title="Instagram">
                      
                        <i class="fa fa-fw fa-instagram"></i>Instagram</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://facebook.com/yanyan.nie.946" target="_blank" title="Facebook">
                      
                        <i class="fa fa-fw fa-facebook"></i>Facebook</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:nieyanyan.syoco@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Site Access
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.root-me.org/?lang=en#" title="Root Me" target="_blank">Root Me</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#文件上传漏洞"><span class="nav-number">1.</span> <span class="nav-text">文件上传漏洞</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#上传检测绕过技术"><span class="nav-number">1.1.</span> <span class="nav-text">上传检测绕过技术</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#客户端-JS-检测及绕过"><span class="nav-number">1.1.1.</span> <span class="nav-text">客户端 JS 检测及绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#服务器端-MIME-检测及绕过"><span class="nav-number">1.1.2.</span> <span class="nav-text">服务器端 MIME 检测及绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#服务器端文件扩展名检测及绕过"><span class="nav-number">1.1.3.</span> <span class="nav-text">服务器端文件扩展名检测及绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#服务器端文件内容检测及绕过"><span class="nav-number">1.1.4.</span> <span class="nav-text">服务器端文件内容检测及绕过</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#文件解析攻击"><span class="nav-number">1.2.</span> <span class="nav-text">文件解析攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#htaccess-攻击"><span class="nav-number">1.2.1.</span> <span class="nav-text">.htaccess 攻击</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web-服务器解析漏洞攻击"><span class="nav-number">1.2.2.</span> <span class="nav-text">web 服务器解析漏洞攻击</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#竞争条件攻击"><span class="nav-number">1.3.</span> <span class="nav-text">竞争条件攻击</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#DVWA-测试过程"><span class="nav-number">2.</span> <span class="nav-text">DVWA 测试过程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#PHP-FILES-数组"><span class="nav-number">2.1.</span> <span class="nav-text">PHP $_FILES 数组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Level-Low"><span class="nav-number">2.2.</span> <span class="nav-text">Level Low</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Level-Medium"><span class="nav-number">2.3.</span> <span class="nav-text">Level Medium</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Level-High"><span class="nav-number">2.4.</span> <span class="nav-text">Level High</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Level-Impossible"><span class="nav-number">2.5.</span> <span class="nav-text">Level Impossible</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yanyan NIE</span>

  
</div>

<!-- 
  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>
  -->



        
<div class="busuanzi-count">
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  
    <span class="site-uv">
      <i class="fa fa-user"></i> visitors
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> total
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: '5ctOlCB3P2wccSY5cq5VAL99-gzGzoHsz',
        appKey: 'IFNf4fFm9whRJLaAOUbh636F',
        placeholder: 'Add your comments',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  

  

  
  

  

  

  

</body>
</html>
